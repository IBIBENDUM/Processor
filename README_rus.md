# Processor
Проект содержит Ассемблер и устройство обработки программ (SPU).

Ассемблер компилирует программу, написанную пользователем, и, если в программе есть ошибки, сообщает пользователю об их местонахождении. После успешной компиляции будут созданы два файла: файл листинга и файл байткода.

SPU выполняет команды из файла, сформированного ассемблером. Данные хранятся в стеке и оперативной памяти.

## Ассемблер
Пример синтаксиса
~~~
    push 5
    push 1
    sub
    out; print 5-1 = 4
    HLT
~~~

Процессор поддерживает 19 команд.

В приведенной ниже таблице ---, --I и т.д. являются возможными комбинациями аргументов.

| --- | --I | -RI | -R- | M-I | MR- | MRI |
| --- | --- | --- | --- | --- | --- | --- |

 Таким образом, команда `push`, поддерживающая комбинацию `MRI`, будет принимать все три аргумента, например `push [rax + 5]`.

### Базовые команды
| NAME | CODE | --- | --I | -RI | -R- | M-I | MR- | MRI |                 DESCRIPTION                  |
|:----:|:----:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:--------------------------------------------:|
| push |  1   |  -  |  +  |  +  |  +  |  +  |  +  |  +  |                 push в стек                  |
| pop  |  2   |  +  |  -  |  -  |  +  |  +  |  +  |  +  |                 pop из стека                 |
| out  |  14  |  +  |  -  |  -  |  -  |  -  |  -  |  -  | вывести последнее значение из стека в stdout |
|  in  |  13  |  +  |  -  |  -  |  -  |  -  |  -  |  -  |             push в стек из stdin             |
| HLT  |  12  |  +  |  -  |  -  |  -  |  -  |  -  |  -  |             завершить программу              |
| dump |  15  |  +  |  -  |  -  |  -  |  -  |  -  |  -  |       вывести данные из VRAM в stdout        |

### Прыжки
Команда `jmp` осуществляет переход по номеру команды, например
```
jmp 16; переход к команде с номером 16
jmp label; переход к команде, на которую указывает label
```

Доступны условные переходы, которые выполняются при определенном условии, например:
```
push 4
push 4
je mark; переход будет выполнен, так как два последних значения в стеке равны
~~~
push 4
push 3
jb mark; переход не будет выполнен, так как 4 > 3
```

>[!IMPORTANT]
>Условные переходы забирают два последних значения из стека и не возвращают из обратно

Команда `call` работает по тому же принципу, что и `jmp`, за исключением того, что перед переходом текущая позиция сохраняется в стеке. После завершения работы вызванного метода программа может вернуться на исходную позицию с помощью команды `ret`.

>[!IMPORTANT]
>`ret` вернет нас обратно, но последнее значение стека должно быть тем же номером, который сохранила команда `call`.

Все переходы поддерживают такие комбинации аргументов: --I, -R-, M-I, MR-, MRI

| NAME | CODE |    DESCRIPTION    |
|:----:|:----:|:-----------------:|
| jmp  |  4   |  обычный переход  |
| call |  5   | переход к методу  |
| ret  |  6   | возврат из метода |
|  ja  |  7   |  переход если >   |
| jae  |  8   |  переход если >=  |
|  jb  |  9   |  переход если <   |
| jbe  |  10  |  переход если <=  |
|  je  |  11  |  переход если ==  |

Передавать значения в метод можно с помощью регистров или через оперативную память
```
push 4
pop rax
call method; если в методе написать `push rax`, то 4 будет помещено в стек
~~~
push 4
pop [5]
call method;  если в методе написать `push [5]`, то 4 будет помещено в стек
```

### Математические команды
| NAME | CODE |    DESCRIPTION    |
|:----:|:----:|:-----------------:|
| sqrt |  3   | квадратный корень |
| add  |  16  |     сложение      |
| sub  |  17  |     вычитание     |
| mul  |  18  |     умножение     |
| div  |  19  |      деление       |

## Как использовать
### Assembler
- `-h` Вывод справочную информацию в консоль
- `-i` Выбор входного файла
- `-o` Выбор выходного файла
-  `-l` Выбор файл для листинга
- `-m` Выбор уровня сообщения логов

Для компиляции примера quadratic_solver введите в консоль следующую команду:
```
asm -i ../Examples/Text/quadratic_solver.s  -o ../Examples/Binaries/quadratic_solver.asm -m ERROR
```
### SPU
- `-h` Вывод справочную информацию в консоль
- `-i` Выбор входного файла
- `-o` Выбор выходного файла
- `-m` Выбор уровня сообщения логов

Для компиляции примера quadratic_solver введите в консоль следующую команду:
```
spu -i ../Examples/Binaries/quadratic_solver.asm -m ERROR
```

## Examples
- quadratic_solver решатель квадратных уравнений
- factorial_calc калькулятор факториала
- draw_circle нарисовать окружность

## Build
Для сборки проекта наберите в консоли `make` в папке Assembler, затем еще раз в папке CPU.
